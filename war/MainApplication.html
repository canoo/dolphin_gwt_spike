<html>
<head>

    <!--                                           -->
    <!-- Any title is fine                         -->
    <!--                                           -->
    <title>Open Dolphin GWT Spike</title>

    <link type="text/css" rel="stylesheet" href="MainApplication.css">

    <!--                                            -->
    <!-- This script is required bootstrap stuff.   -->
    <!--                                            -->
    <script type="text/javascript" language="javascript" src="MainApplication/MainApplication.nocache.js"></script>
    <script type="text/javascript" language="javascript" src="dd.js"></script>
    <script type="text/javascript" language="javascript" src="libs/require.js"></script>
    <script type="text/javascript" language="javascript" src="config.js"></script>

    <script id="dolphinCode">
        require([
            'Dolphin',
            'comm/ClientAttribute'
        ], function (Dolphin, ClientAttribute) {
//            var dolphin = new Dolphin("https://klondike.canoo.com/dolphin-grails/dolphin/");
            var dolphin = new Dolphin("http://127.0.0.1:8888/dolphin/");

            // create named PM with attribute on the client side
            var textAttribute  = new ClientAttribute("attrId");
            var rangeAttribute = new ClientAttribute("range");
            console.log("INIT PM");
            dolphin.getClientDolphin().presentationModel(
                    "org.opendolphin.demo.Tutorial.modelId", undefined,
                    textAttribute, rangeAttribute
            );

            // send echo command on button click
            var logActionButton = document.getElementById("logActionButton");
            logActionButton.addEventListener("click", function () {
                dolphin.getClientDolphin().send("org.opendolphin.demo.Tutorial.echo");
            });

            // bind text input field to pm textAttribute bidirectionally
            var textInput = document.getElementById("textInput");
            textInput.addEventListener("input", function () {
                textAttribute.setValue(textInput.value);
            });
            textAttribute.on("valueChange", function (data) {
                textInput.value = data.newValue;
            });

            // bind label to textAttribute
            var label = document.getElementById("label");
            textAttribute.on("valueChange", function (data) {
                label.innerHTML = data.newValue;
            });

            // bind range input field to pm rangeAttribute and label to pm
            var rangeInput  = document.getElementById("range");
            var rangeOutput = document.getElementById("rangeLabel");
            rangeInput.addEventListener("input", function () {
                rangeAttribute.setValue(rangeInput.value);
            });
            rangeAttribute.on("valueChange", function (data) {
                rangeOutput.innerHTML = data.newValue;
            });

            // send add command on button click and add a div for each received model
            var addButton = document.getElementById("addButton");
            var list      = document.getElementById("list");
            addButton.addEventListener("click", function () {
                dolphin.getClientDolphin().send("org.opendolphin.demo.Tutorial.add", function (models) {
                    console.log("NEW models", models);
                    models.forEach(function (model) {
                        var element = document.createElement("div");
                        element.innerHTML = model.presentationModelType + ": " + model.attributes[0].value;
                        list.appendChild(element);
                    })
                });
            });

        });
    </script>
</head>

<!--                                           -->
<!-- The body can have arbitrary html, or      -->
<!-- you can leave the body empty if you want  -->
<!-- to create a completely dynamic ui         -->
<!--                                           -->
<body>

<h1>Open Dolphin GWT Spike</h1>


<table align="center">
    <tr>
        <td id="slot1"></td>
        <td id="slot2"></td>
    </tr>
</table>
</body>
</html>
